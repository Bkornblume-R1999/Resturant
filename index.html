<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test â€” Restaurant Ordering System</title>
<style>
/* â”€â”€â”€ RESET â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:'Segoe UI',system-ui,sans-serif}
body{min-height:100vh;transition:background .3s,color .3s}
button{font-family:inherit;cursor:pointer}
input,select,textarea{font-family:inherit}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{border-radius:3px}

/* â”€â”€â”€ DARK / LIGHT â”€â”€â”€ */
body.dark{
  --bg:#0d0d0b;--surf:#141410;--surf2:#1c1c16;--border:#2a2a20;
  --text:#f0ead8;--muted:#7a7a68;--accent:#e8c547;--danger:#e05252;
  --success:#4caf7d;--orange:#ff6b35;--card:#181814;--inp:#1c1c16;
  --sh:rgba(0,0,0,.45);
  --land:radial-gradient(ellipse 70% 55% at 50% 38%,#1c1c10 0%,#0d0d0b 100%)
}
body.light{
  --bg:#f5f3ed;--surf:#fff;--surf2:#f0ede4;--border:#ddd8c8;
  --text:#1a1a10;--muted:#888870;--accent:#c8a000;--danger:#d03030;
  --success:#2e8f5a;--orange:#e05520;--card:#faf8f2;--inp:#f5f3ed;
  --sh:rgba(0,0,0,.1);
  --land:radial-gradient(ellipse 70% 55% at 50% 38%,#fffef5 0%,#f5f3ed 100%)
}
body{background:var(--bg);color:var(--text)}
::-webkit-scrollbar-thumb{background:var(--border)}

/* â”€â”€â”€ ANIMATIONS â”€â”€â”€ */
@keyframes popIn  {from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
@keyframes slideIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}
@keyframes fadeUp {from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin   {to{transform:rotate(360deg)}}
@keyframes pulse  {0%,100%{opacity:1}50%{opacity:.4}}

/* â”€â”€â”€ SCREENS â”€â”€â”€ */
.screen{display:none;flex-direction:column;min-height:100vh}
.screen.active{display:flex}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#landing{align-items:center;justify-content:center;position:relative;overflow:hidden;background:var(--land)}
.land-top{position:absolute;top:20px;right:24px;z-index:10}
.land-content{position:relative;z-index:2;text-align:center;animation:fadeUp .65s ease both}
.land-logo{font-family:Georgia,serif;font-size:clamp(4rem,10vw,7rem);font-weight:900;color:var(--accent);line-height:1;letter-spacing:-.02em}
body.dark .land-logo{text-shadow:0 0 80px rgba(232,197,71,.25)}
.land-tag{font-size:.82rem;color:var(--muted);letter-spacing:.25em;text-transform:uppercase;margin:8px 0 48px}
.role-cards{display:flex;gap:20px;flex-wrap:wrap;justify-content:center}
.role-card{background:var(--surf);border:1px solid var(--border);border-radius:18px;padding:2.5rem 2rem;width:210px;cursor:pointer;text-align:center;transition:all .25s}
.role-card:hover{transform:translateY(-6px);box-shadow:0 12px 32px var(--sh)}
.role-card.guest:hover{border-color:var(--accent)}
.role-card.admin:hover{border-color:var(--orange)}
.role-icon{font-size:3rem;display:block;margin-bottom:12px}
.role-title{font-family:Georgia,serif;font-size:1.4rem;font-weight:700;margin-bottom:6px;color:var(--text)}
.role-desc{font-size:.8rem;color:var(--muted);line-height:1.5}

/* â”€â”€â”€ THEME BUTTON â”€â”€â”€ */
.theme-btn{background:transparent;border:1px solid var(--border);border-radius:8px;padding:.35rem .65rem;font-size:.9rem;color:var(--muted);transition:all .2s;display:flex;align-items:center;gap:5px}
.theme-btn span{font-size:.75rem}

/* â”€â”€â”€ MODAL â”€â”€â”€ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(5px);z-index:2000;align-items:center;justify-content:center;padding:1rem}
.modal-overlay.open{display:flex}
.modal-box{background:var(--surf);border:1px solid var(--border);border-radius:20px;padding:2rem;width:100%;max-width:440px;animation:popIn .25s ease;max-height:92vh;overflow-y:auto;box-shadow:0 20px 60px var(--sh)}
.modal-title{font-family:Georgia,serif;font-size:1.55rem;color:var(--accent);margin-bottom:5px}
.modal-sub{color:var(--muted);font-size:.86rem;margin-bottom:18px}
.modal-divider{border:none;border-top:1px solid var(--border);margin:14px 0}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.app-header{background:var(--surf);border-bottom:1px solid var(--border);padding:.85rem 1.5rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 1px 8px var(--sh);flex-shrink:0}
.hdr-logo{font-family:Georgia,serif;font-size:1.6rem;font-weight:900;color:var(--accent)}
.hdr-right{display:flex;align-items:center;gap:10px}
.sync-wrap{display:flex;align-items:center;gap:5px;font-size:.73rem;color:var(--muted)}
.sync-dot{width:7px;height:7px;border-radius:50%;background:var(--success);box-shadow:0 0 5px var(--success);transition:all .3s;flex-shrink:0}
.sync-dot.saving{background:var(--orange);box-shadow:none;animation:pulse 1s infinite}
.sync-dot.offline{background:var(--muted);box-shadow:none}
.exit-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:.33rem .85rem;border-radius:8px;font-size:.8rem;transition:all .2s}
.exit-btn:hover{border-color:var(--danger);color:var(--danger)}

/* â”€â”€â”€ CATEGORY TABS â”€â”€â”€ */
.tabs-bar{background:var(--surf);border-bottom:1px solid var(--border);padding:0 1.5rem;display:flex;overflow-x:auto;flex-shrink:0}
.tab-btn{padding:.85rem 1.1rem;background:none;border:none;color:var(--muted);font-size:.87rem;font-weight:400;white-space:nowrap;border-bottom:2px solid transparent;transition:all .2s}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);font-weight:600}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSUMER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.c-body{flex:1;display:flex;overflow:hidden}

/* MENU */
.menu-panel{flex:1;padding:1.5rem;overflow-y:auto}
.menu-section-title{font-family:Georgia,serif;font-size:1.4rem;margin-bottom:1rem;color:var(--text)}
.menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:1rem}
.menu-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .2s;position:relative}
.menu-card:hover:not(.unavail){border-color:var(--accent);transform:translateY(-3px);box-shadow:0 8px 24px var(--sh)}
.menu-card.unavail{opacity:.55;cursor:default}
.unavail-ribbon{position:absolute;top:8px;right:8px;background:var(--danger);color:#fff;font-size:.62rem;font-weight:700;padding:.15rem .5rem;border-radius:20px;letter-spacing:.06em;text-transform:uppercase}
.card-img{width:100%;height:130px;object-fit:cover;display:block}
.card-ph{width:100%;height:130px;background:var(--surf2);display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:var(--border)}
.card-body{padding:1rem}
.card-name{font-weight:600;font-size:.95rem;margin-bottom:4px;color:var(--text)}
.card-desc{font-size:.75rem;color:var(--muted);margin-bottom:10px;line-height:1.4;min-height:2em}
.card-footer{display:flex;align-items:center;justify-content:space-between}
.card-price{font-family:monospace;font-size:.97rem;color:var(--accent);font-weight:600}
.add-btn{width:32px;height:32px;border-radius:8px;background:var(--accent);border:none;color:#0a0a08;font-size:1.2rem;font-weight:700;display:flex;align-items:center;justify-content:center;transition:all .15s}
.add-btn:hover{opacity:.85;transform:scale(1.1)}

/* CART */
.cart-panel{width:320px;border-left:1px solid var(--border);background:var(--surf);display:flex;flex-direction:column;max-height:calc(100vh - 110px);overflow:hidden;flex-shrink:0}
.cart-hdr{padding:1.1rem 1.4rem;border-bottom:1px solid var(--border)}
.cart-title{font-family:Georgia,serif;font-size:1.15rem;color:var(--accent)}
.cart-items{flex:1;overflow-y:auto;padding:.6rem 1.4rem}
.cart-empty{text-align:center;padding:2rem;color:var(--muted);font-size:.85rem}
.cart-item{display:flex;align-items:flex-start;gap:8px;padding:.6rem 0;border-bottom:1px solid var(--border)}
.ci-info{flex:1;min-width:0}
.ci-name{font-size:.84rem;color:var(--text);font-weight:500}
.ci-mods{font-size:.7rem;color:var(--muted);margin-top:2px;line-height:1.4}
.ci-qty{display:flex;align-items:center;gap:4px;margin-top:5px}
.qty-btn{width:23px;height:23px;border-radius:6px;background:var(--surf2);border:1px solid var(--border);color:var(--text);font-size:.95rem;display:flex;align-items:center;justify-content:center;transition:all .15s}
.qty-btn:hover{background:var(--border)}
.qty-num{font-family:monospace;font-size:.83rem;min-width:18px;text-align:center;color:var(--text)}
.ci-price{font-family:monospace;font-size:.8rem;color:var(--accent);min-width:56px;text-align:right;padding-top:2px}
.cart-ftr{padding:1.1rem 1.4rem;border-top:1px solid var(--border)}
.cart-total-row{display:flex;justify-content:space-between;margin-bottom:14px}
.cart-total-lbl{font-weight:600;color:var(--text)}
.cart-total-amt{font-family:monospace;font-size:1.2rem;color:var(--accent)}

/* â”€â”€ PLACE ORDER BUTTON â”€â”€ */
.place-order-btn{
  display:block; width:100%;
  background:var(--accent); color:#0a0a08;
  padding:.9rem; border-radius:12px;
  font-weight:700; font-size:.93rem;
  border:2px solid transparent;
  cursor:pointer; transition:background .25s,color .25s,border-color .25s,opacity .25s;
  line-height:1.2; text-align:center
}
.place-order-btn:not([disabled]):not(.cd):hover{opacity:.88}
.place-order-btn[disabled]:not(.cd){background:var(--border)!important;color:var(--muted)!important;border-color:transparent!important;cursor:not-allowed}
.place-order-btn.cd{background:var(--surf2)!important;color:var(--muted)!important;border-color:var(--border)!important;cursor:not-allowed!important}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ITEM CUSTOMISATION MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cust-img{width:100%;height:150px;object-fit:cover;border-radius:12px;margin-bottom:14px;display:block}
.cust-ph{width:100%;height:100px;background:var(--surf2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2.8rem;margin-bottom:14px}
.mod-section{margin-bottom:14px}
.mod-lbl{display:block;font-size:.72rem;color:var(--muted);font-weight:600;letter-spacing:.06em;text-transform:uppercase;margin-bottom:8px}
.mod-chips{display:flex;gap:6px;flex-wrap:wrap}
.chip{padding:.3rem .72rem;border-radius:20px;font-size:.78rem;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;transition:all .15s}
.chip.sel{background:var(--accent);color:#0a0a08;border-color:var(--accent);font-weight:600}
.chip.multi.sel{background:var(--orange);color:#fff;border-color:var(--orange)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORDER REVIEW MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rev-row{display:flex;justify-content:space-between;align-items:flex-start;gap:8px;padding:.5rem 0;border-bottom:1px solid var(--border);font-size:.87rem}
.rev-mods{font-size:.72rem;color:var(--muted);margin-top:2px}
.rev-price{font-family:monospace;color:var(--accent);white-space:nowrap}
.rev-total-row{display:flex;justify-content:space-between;padding:.75rem 0 0;font-weight:700}
.rev-total-amt{font-family:monospace;font-size:1.2rem;color:var(--accent)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAYMENT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pay-opts{display:flex;gap:12px;margin-bottom:16px}
.pay-opt{flex:1;border:2px solid var(--border);border-radius:14px;padding:1.2rem 1rem;cursor:pointer;text-align:center;transition:all .2s;background:transparent}
.pay-opt:hover,.pay-opt.sel{border-color:var(--accent)}
.pay-opt.sel{background:rgba(232,197,71,.08)}
.pay-icon{font-size:2rem;display:block;margin-bottom:6px}
.pay-label{font-size:.85rem;font-weight:600;color:var(--text)}
.pay-sub{font-size:.72rem;color:var(--muted);margin-top:2px}
.info-box{background:var(--surf2);border-radius:12px;padding:1rem;font-size:.84rem;color:var(--muted);line-height:1.6}
.qr-box{width:170px;height:170px;margin:1rem auto;background:var(--surf2);border:2px dashed var(--border);border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;color:var(--muted)}
.qr-box span:first-child{font-size:3rem}
.qr-box span:last-child{font-size:.74rem;text-align:center;padding:0 .5rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORDER CONFIRMED MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.conf-wrap{text-align:center}
.conf-emoji{font-size:3rem;margin-bottom:10px}
.conf-title{font-family:Georgia,serif;font-size:1.75rem;color:var(--accent);margin-bottom:6px}
.conf-sub{color:var(--muted);font-size:.86rem;margin-bottom:4px}
.conf-num{font-family:monospace;font-size:4rem;color:var(--accent);letter-spacing:.08em;margin:.4rem 0 .8rem;line-height:1;font-weight:700}
.conf-msg{color:var(--text);font-size:.87rem;line-height:1.6;margin-bottom:16px}
.conf-badge{display:inline-flex;align-items:center;gap:5px;padding:.28rem 1rem;border-radius:20px;font-size:.7rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;margin-bottom:20px}
.conf-badge.cash{background:rgba(232,197,71,.15);color:var(--accent)}
.conf-badge.online{background:rgba(76,175,125,.15);color:var(--success)}
.done-btn{width:100%;background:var(--accent);color:#0a0a08;padding:.95rem;border-radius:12px;font-weight:700;font-size:1rem;border:none;transition:all .2s;margin-top:8px;cursor:pointer}
.done-btn:hover{opacity:.88}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-body{flex:1;padding:1.5rem;display:flex;flex-direction:column;gap:1.5rem;overflow-y:auto}
.stats-row{display:flex;gap:1rem;flex-wrap:wrap}
.stat-card{background:var(--surf);border:1px solid var(--border);border-radius:14px;padding:1.1rem 1.4rem;min-width:155px}
.stat-lbl{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:4px}
.stat-val{font-family:monospace;font-size:1.7rem}
.admin-section{background:var(--surf);border:1px solid var(--border);border-radius:16px;overflow:hidden}
.admin-sec-hdr{padding:1rem 1.4rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.admin-sec-title{font-family:Georgia,serif;font-size:1.1rem;color:var(--accent)}

/* ORDERS TABLE */
.orders-wrap{overflow-x:auto}
.orders-tbl{width:100%;border-collapse:collapse}
.orders-tbl th{padding:.65rem 1.1rem;text-align:left;font-size:.7rem;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);border-bottom:1px solid var(--border);white-space:nowrap}
.orders-tbl td{padding:.85rem 1.1rem;border-bottom:1px solid var(--border);font-size:.87rem;vertical-align:top}
.oi-list{font-size:.78rem;color:var(--muted)}
.badge{display:inline-block;padding:.22rem .65rem;border-radius:20px;font-size:.7rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase}
.b-pending {background:rgba(232,197,71,.15);color:#c8a000}
.b-accepted{background:rgba(76,175,125,.15);color:#2e8f5a}
.b-declined{background:rgba(224,82,82,.15) ;color:#d03030}
.act-wrap{display:flex;gap:6px;flex-wrap:wrap}
.btn-accept,.btn-decline{padding:.3rem .7rem;border-radius:7px;font-size:.76rem;font-weight:600;border:none;transition:all .15s}
.btn-accept {background:rgba(76,175,125,.18);color:var(--success)}
.btn-accept:hover {background:var(--success);color:#fff}
.btn-decline{background:rgba(224,82,82,.18) ;color:var(--danger)}
.btn-decline:hover{background:var(--danger);color:#fff}

/* ADMIN MENU TABS */
.admin-tabs{display:flex;border-bottom:1px solid var(--border);overflow-x:auto;padding:0 1.4rem}
.atab-btn{padding:.7rem 1.05rem;background:none;border:none;color:var(--muted);font-size:.8rem;cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;transition:all .2s;font-weight:400}
.atab-btn.active{color:var(--orange);border-bottom-color:var(--orange);font-weight:600}
.add-item-btn{background:var(--orange);color:#fff;padding:.48rem 1.05rem;border-radius:9px;border:none;font-weight:600;font-size:.83rem;transition:all .2s}
.add-item-btn:hover{opacity:.88}

/* ADMIN MENU GRID */
.admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;padding:1.2rem 1.4rem}
.ai-card{background:var(--surf2);border:1px solid var(--border);border-radius:12px;overflow:hidden;transition:opacity .2s}
.ai-card.unavail{opacity:.6}
.ai-img{width:100%;height:110px;object-fit:cover;display:block}
.ai-ph{width:100%;height:110px;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:2rem;color:var(--border)}
.ai-body{padding:.9rem}
.ai-name{font-weight:600;font-size:.93rem;color:var(--text);margin-bottom:3px}
.ai-price{font-family:monospace;color:var(--accent);font-size:.87rem;margin-bottom:4px}
.ai-desc{font-size:.75rem;color:var(--muted);line-height:1.4}
.ai-unavail-tag{display:inline-block;margin-top:5px;padding:.15rem .5rem;background:rgba(224,82,82,.15);color:var(--danger);font-size:.64rem;font-weight:700;border-radius:10px;text-transform:uppercase;letter-spacing:.06em}
.ai-actions{display:flex;gap:5px;margin-top:10px;flex-wrap:wrap}
.btn-ai{flex:1;min-width:0;padding:.3rem .3rem;border-radius:7px;font-size:.71rem;font-weight:600;background:transparent;transition:all .15s;white-space:nowrap}
.btn-edit  {border:1px solid var(--border);color:var(--muted)}
.btn-edit:hover{border-color:var(--accent);color:var(--accent)}
.btn-navail{border:1px solid rgba(224,82,82,.35);color:var(--danger)}
.btn-navail:hover{background:var(--danger);color:#fff;border-color:var(--danger)}
.btn-avail {border:1px solid rgba(76,175,125,.35);color:var(--success)}
.btn-avail:hover{background:var(--success);color:#fff;border-color:var(--success)}
.btn-del   {border:1px solid rgba(224,82,82,.35);color:var(--danger)}
.btn-del:hover{background:var(--danger);color:#fff;border-color:var(--danger)}

/* â”€â”€â”€ FORMS â”€â”€â”€ */
.fg{margin-bottom:13px}
.fg label{display:block;font-size:.73rem;color:var(--muted);margin-bottom:4px;letter-spacing:.05em}
.finput,.fselect,.ftextarea{width:100%;background:var(--inp);border:1px solid var(--border);border-radius:9px;padding:.68rem .88rem;color:var(--text);font-size:.87rem;outline:none;transition:border-color .2s}
.finput:focus,.fselect:focus,.ftextarea:focus{border-color:var(--accent)}
.ftextarea{resize:vertical;min-height:72px}
.fselect option{background:var(--surf)}
/* toggle */
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:13px}
.toggle-row span{font-size:.87rem;color:var(--text)}
.sw{position:relative;width:42px;height:24px}
.sw input{display:none}
.sw-slider{position:absolute;inset:0;background:var(--border);border-radius:24px;cursor:pointer;transition:.3s}
.sw-slider::before{content:'';position:absolute;width:18px;height:18px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.3s}
.sw input:checked+.sw-slider{background:var(--success)}
.sw input:checked+.sw-slider::before{transform:translateX(18px)}
/* image upload */
.img-zone{border:2px dashed var(--border);border-radius:10px;overflow:hidden;cursor:pointer;background:var(--inp);transition:border-color .2s;position:relative}
.img-zone.has-img{border-color:var(--success)}
.img-zone:hover{border-color:var(--accent)}
.img-zone img.prev{width:100%;height:140px;object-fit:cover;display:block}
.img-ph{height:100px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;color:var(--muted);font-size:.78rem}
.img-ph span:first-child{font-size:1.8rem}
.img-rm{position:absolute;top:6px;right:6px;width:26px;height:26px;border-radius:50%;background:rgba(0,0,0,.6);border:none;color:#fff;font-size:.75rem;display:flex;align-items:center;justify-content:center;cursor:pointer}
/* modal buttons */
.mact{display:flex;gap:10px;margin-top:16px}
.btn-prim{flex:1;background:var(--accent);color:#0a0a08;padding:.78rem;border-radius:10px;border:none;font-weight:700;font-size:.88rem;transition:all .2s;cursor:pointer}
.btn-prim:hover{opacity:.88}
.btn-prim.org{background:var(--orange);color:#fff}
.btn-prim.grn{background:var(--success);color:#fff}
.btn-prim.red{background:var(--danger);color:#fff}
.btn-ghost{flex:1;background:transparent;border:1px solid var(--border);color:var(--muted);padding:.78rem;border-radius:10px;font-weight:500;font-size:.88rem;transition:all .2s;cursor:pointer}
.btn-ghost:hover{border-color:var(--muted);color:var(--text)}
/* pin */
.pin-inp{width:100%;background:var(--inp);border:1px solid var(--border);border-radius:10px;padding:.85rem 1rem;color:var(--text);font-family:monospace;font-size:1.3rem;letter-spacing:.3em;text-align:center;outline:none;margin-bottom:8px;transition:border-color .2s}
.pin-inp:focus{border-color:var(--accent)}
.pin-err{color:var(--danger);font-size:.8rem;min-height:1.1em;margin-bottom:12px}

/* DELETE CONFIRM */
.del-icon{text-align:center;font-size:2.5rem;margin-bottom:8px}
.del-msg{text-align:center;color:var(--muted);font-size:.88rem;margin-bottom:18px}
.del-name{color:var(--text);font-weight:600}

/* TOAST */
#toasts{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{background:var(--surf);border:1px solid var(--border);border-radius:12px;padding:.85rem 1.2rem;font-size:.87rem;max-width:280px;color:var(--text);box-shadow:0 4px 16px var(--sh);animation:slideIn .25s ease}
.toast.success{border-left:3px solid var(--success)}
.toast.error  {border-left:3px solid var(--danger)}
.toast.info   {border-left:3px solid var(--accent)}

/* MISC */
.empty-state{text-align:center;padding:4rem 2rem;color:var(--muted);grid-column:1/-1}
.empty-ico{font-size:3rem;opacity:.35;margin-bottom:10px}
.no-data{text-align:center;padding:2.5rem;color:var(--muted);font-size:.88rem}
.firebase-note{background:var(--surf2);border:1px solid var(--border);border-radius:10px;padding:.9rem 1.1rem;font-size:.8rem;color:var(--muted);line-height:1.6;margin-bottom:1.2rem}
.firebase-note strong{color:var(--accent)}
</style>
</head>
<body class="dark">

<!-- â•â•â•â• LANDING â•â•â•â• -->
<div id="landing" class="screen active">
  <div class="land-top">
    <button class="theme-btn" onclick="toggleTheme()" id="landThemeBtn">â˜€ï¸ <span>Light</span></button>
  </div>
  <div class="land-content">
    <div class="land-logo">Test</div>
    <div class="land-tag">Restaurant Ordering System</div>
    <div class="role-cards">
      <div class="role-card guest" onclick="enterConsumer()">
        <span class="role-icon">ğŸ½ï¸</span>
        <div class="role-title">Guest</div>
        <div class="role-desc">Browse the menu &amp; place your order</div>
      </div>
      <div class="role-card admin" onclick="openAdminLogin()">
        <span class="role-icon">ğŸ”‘</span>
        <div class="role-title">Admin</div>
        <div class="role-desc">Manage menu &amp; process orders</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â• CONSUMER SCREEN â•â•â•â• -->
<div id="consumerScreen" class="screen">
  <div class="app-header">
    <div class="hdr-logo">Test</div>
    <div class="hdr-right">
      <div class="sync-wrap"><div class="sync-dot" id="cDot"></div><span id="cDotLbl">Live</span></div>
      <button class="theme-btn" onclick="toggleTheme()" id="cThemeBtn">â˜€ï¸ <span>Light</span></button>
      <button class="exit-btn" onclick="exitToLanding()">â† Exit</button>
    </div>
  </div>
  <div class="tabs-bar" id="cTabs"></div>
  <div class="c-body">
    <div class="menu-panel">
      <div class="menu-section-title" id="menuTitle"></div>
      <div class="menu-grid" id="menuGrid"></div>
    </div>
    <div class="cart-panel">
      <div class="cart-hdr"><div class="cart-title">ğŸ›’ Your Order</div></div>
      <div class="cart-items" id="cartItems"><div class="cart-empty">Your cart is empty</div></div>
      <div class="cart-ftr">
        <div class="cart-total-row">
          <span class="cart-total-lbl">Total</span>
          <span class="cart-total-amt" id="cartTotal">â‚±0.00</span>
        </div>
        <button class="place-order-btn" id="placeBtn" onclick="openOrderReview()" disabled>Place Order</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â• ADMIN SCREEN â•â•â•â• -->
<div id="adminScreen" class="screen">
  <div class="app-header">
    <div class="hdr-logo">Test</div>
    <div class="hdr-right">
      <div class="sync-wrap"><div class="sync-dot" id="aDot"></div><span id="aDotLbl">Live</span></div>
      <button class="theme-btn" onclick="toggleTheme()" id="aThemeBtn">â˜€ï¸ <span>Light</span></button>
      <button class="exit-btn" onclick="exitToLanding()">â† Exit</button>
    </div>
  </div>
  <div class="admin-body">
    <div id="fbNote" style="display:none" class="firebase-note">
      âš ï¸ <strong>Local Mode:</strong> Data is stored on this device only. To enable <strong>multi-device sync</strong>, open this file in a text editor and fill in your <strong>Firebase config</strong> at the top of the &lt;script&gt; block. Get a free config at <strong>console.firebase.google.com</strong>.
    </div>
    <div class="stats-row" id="statsRow"></div>
    <div class="admin-section">
      <div class="admin-sec-hdr"><div class="admin-sec-title">ğŸ“‹ Customer Orders</div></div>
      <div id="ordersWrap"><div class="no-data">No orders yet.</div></div>
    </div>
    <div class="admin-section">
      <div class="admin-sec-hdr">
        <div class="admin-sec-title">ğŸ´ Menu Management</div>
        <button class="add-item-btn" onclick="openAddItem()">+ Add Item</button>
      </div>
      <div class="admin-tabs" id="adminTabs"></div>
      <div class="admin-grid" id="adminGrid"></div>
    </div>
  </div>
</div>

<!-- â•â• MODAL: ADMIN LOGIN â•â• -->
<div class="modal-overlay" id="loginModal">
  <div class="modal-box">
    <div class="modal-title">Admin Access</div>
    <div class="modal-sub">Enter your 4-digit PIN to continue</div>
    <input class="pin-inp" id="pinInput" type="password" maxlength="4" placeholder="â€¢â€¢â€¢â€¢"
      oninput="document.getElementById('pinErr').textContent=''"
      onkeydown="if(event.key==='Enter')checkPin()">
    <div class="pin-err" id="pinErr"></div>
    <div class="mact">
      <button class="btn-ghost" onclick="closeModal('loginModal')">Cancel</button>
      <button class="btn-prim" onclick="checkPin()">Unlock</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: ITEM CUSTOMISATION â•â• -->
<div class="modal-overlay" id="custModal">
  <div class="modal-box" style="max-width:400px">
    <div class="modal-title" id="custName">Item</div>
    <div class="modal-sub" id="custPrice"></div>
    <div id="custImgWrap"></div>
    <div class="mod-section" id="sugarSec">
      <span class="mod-lbl">ğŸ¬ Sugar Level</span>
      <div class="mod-chips" id="sugarChips"></div>
    </div>
    <div class="mod-section" id="sizeSec">
      <span class="mod-lbl">ğŸ“ Size</span>
      <div class="mod-chips" id="sizeChips"></div>
    </div>
    <div class="mod-section" id="addonSec">
      <span class="mod-lbl">â• Add-ons</span>
      <div class="mod-chips" id="addonChips"></div>
    </div>
    <div class="fg">
      <label>Special Notes (optional)</label>
      <input class="finput" id="custNotes" placeholder="e.g. no onions, extra spicyâ€¦">
    </div>
    <div class="mact">
      <button class="btn-ghost" onclick="closeModal('custModal')">Cancel</button>
      <button class="btn-prim" onclick="addToCart()">Add to Cart</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: ORDER REVIEW â•â• -->
<div class="modal-overlay" id="reviewModal">
  <div class="modal-box" style="max-width:420px">
    <div class="modal-title">Review Order</div>
    <div class="modal-sub">Double-check your items before placing</div>
    <div id="reviewList"></div>
    <hr class="modal-divider">
    <div class="rev-total-row">
      <span>Total</span>
      <span class="rev-total-amt" id="reviewTotal"></span>
    </div>
    <div class="mact" style="margin-top:20px">
      <button class="btn-ghost" onclick="closeModal('reviewModal')">â† Edit Cart</button>
      <button class="btn-prim" onclick="openPayment()">Continue â†’</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: PAYMENT â•â• -->
<div class="modal-overlay" id="payModal">
  <div class="modal-box" style="max-width:400px">
    <div class="modal-title">Payment Method</div>
    <div class="modal-sub">How would you like to pay?</div>
    <div class="pay-opts">
      <button class="pay-opt sel" id="payCash" onclick="selPay('cash')">
        <span class="pay-icon">ğŸ’µ</span>
        <div class="pay-label">Cash</div>
        <div class="pay-sub">Pay at cashier</div>
      </button>
      <button class="pay-opt" id="payOnline" onclick="selPay('online')">
        <span class="pay-icon">ğŸ“±</span>
        <div class="pay-label">Online</div>
        <div class="pay-sub">GCash / PayMaya</div>
      </button>
    </div>
    <div id="cashInfo" class="info-box">
      ğŸ’¡ Your order will be sent to the cashier for confirmation. Please proceed to the counter after placing.
    </div>
    <div id="onlineInfo" style="display:none;text-align:center">
      <div class="qr-box">
        <span>ğŸ“²</span>
        <span>Scan QR to Pay<br>(Admin: add your QR here)</span>
      </div>
      <div class="info-box" style="margin-top:10px">
        ğŸ§¾ <strong>Show your online receipt to the cashier for confirmation!</strong>
      </div>
    </div>
    <div class="mact" style="margin-top:18px">
      <button class="btn-ghost" onclick="closeModal('payModal');openModal('reviewModal')">â† Back</button>
      <button class="btn-prim grn" onclick="finalizeOrder()">âœ“ Place Order</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: ORDER CONFIRMED â•â• -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal-box" style="max-width:400px;border-radius:22px;padding:2.5rem 2rem;text-align:center">
    <div class="conf-wrap">
      <div class="conf-emoji">ğŸ‰</div>
      <div class="conf-title">Order Placed!</div>
      <div class="conf-sub">Your order number is</div>
      <div class="conf-num" id="confNum">#â€”</div>
      <div class="conf-msg" id="confMsg"></div>
      <div id="confBadge"></div>
      <button class="done-btn" onclick="closeDone()">Done</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: ADD / EDIT ITEM â•â• -->
<div class="modal-overlay" id="itemModal">
  <div class="modal-box">
    <div class="modal-title" id="itemModalTitle">Add Item</div>
    <div class="modal-sub"  id="itemModalSub">Fill in the details below</div>
    <input type="hidden" id="editId">
    <div class="fg">
      <label>Product Image</label>
      <div class="img-zone" id="imgZone" onclick="document.getElementById('imgFile').click()">
        <input type="file" id="imgFile" accept="image/*" style="display:none" onchange="handleImg(event)">
        <div class="img-ph" id="imgPh"><span>ğŸ“·</span><span>Click to upload (max 2MB)</span></div>
        <img class="prev" id="imgPrev" src="" alt="" style="display:none">
        <button class="img-rm" id="imgRm" style="display:none" onclick="event.stopPropagation();clearImg()">âœ•</button>
      </div>
    </div>
    <div class="fg">
      <label>Category</label>
      <select class="fselect" id="iCat"></select>
    </div>
    <div class="fg">
      <label>Item Name</label>
      <input class="finput" id="iName" placeholder="e.g. Spaghetti Carbonara">
    </div>
    <div class="fg">
      <label>Price (â‚±)</label>
      <input class="finput" id="iPrice" type="number" min="0" step="0.01" placeholder="0.00">
    </div>
    <div class="fg">
      <label>Description</label>
      <textarea class="ftextarea" id="iDesc" placeholder="Short descriptionâ€¦"></textarea>
    </div>
    <div class="toggle-row">
      <span>Mark as Not Available</span>
      <label class="sw"><input type="checkbox" id="iUnavail"><span class="sw-slider"></span></label>
    </div>
    <div class="mact">
      <button class="btn-ghost" onclick="closeModal('itemModal')">Cancel</button>
      <button class="btn-prim org" onclick="saveItem()">Save Item</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: DELETE CONFIRM â•â• -->
<div class="modal-overlay" id="delModal">
  <div class="modal-box" style="max-width:360px">
    <div class="del-icon">ğŸ—‘ï¸</div>
    <div class="modal-title" style="text-align:center;color:var(--danger)">Delete Item?</div>
    <div class="del-msg">Are you sure you want to delete <span class="del-name" id="delName">"Item"</span>? This <strong>cannot be undone</strong>.</div>
    <div class="mact">
      <button class="btn-ghost" onclick="closeModal('delModal')">Cancel</button>
      <button class="btn-prim red" onclick="confirmDelete()">Yes, Delete</button>
    </div>
  </div>
</div>

<div id="toasts"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  FIREBASE CONFIG  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// Replace the values below with your own Firebase project config.
// Get one free at https://console.firebase.google.com
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey: "AIzaSyBGNM1v4VOwe1DWXukg5KTpyPhxJM9YiQ0",
  authDomain: "menu-9ffd5.firebaseapp.com",
  databaseURL: "https://menu-9ffd5-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "menu-9ffd5",
  storageBucket: "menu-9ffd5.firebasestorage.app",
  messagingSenderId: "157597768163",
  appId: "1:157597768163:web:3a1a73ae8799c05db228d6",
  measurementId: "G-MQMN959HEQ"
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ CONSTANTS â”€â”€â”€
const CATS     = ["Drinks","Desserts","Pasta","Main Course","Snacks","Others"];
const CAT_ICO  = {Drinks:"ğŸ¥¤",Desserts:"ğŸ°",Pasta:"ğŸ","Main Course":"ğŸ–",Snacks:"ğŸŸ",Others:"ğŸ±"};
const PIN      = "0000";
const CD_SECS  = 5;
const SUGARS = ["0%","25%","50%","75%","100%"];

// Per-category sizes
const CAT_SIZES = {
  "Drinks":       ["Small","Medium","Large"],
  "Desserts":     ["Regular","Large"],
  "Pasta":        ["Solo","Sharing"],
  "Main Course":  ["Solo","Sharing"],
  "Snacks":       ["Regular","Large"],
  "Others":       ["Regular","Large"],
};

// Per-category add-ons (only shown when category has them)
const CAT_ADDONS = {
  "Drinks":      ["No Ice","Less Ice","Extra Ice","Extra Shot","Whipped Cream","Boba","Sinkers","Sago","Nata"],
  "Desserts":    ["Extra Sauce","Extra Toppings","Whipped Cream","No Nuts","Less Sweet"],
  "Pasta":       ["Extra Noodles","Extra Sauce","Less Sauce","Extra Cheese","No Cheese","Spicy"],
  "Main Course": ["Extra Rice","Less Rice","Extra Sauce","Spicy","No Veggies","Extra Protein"],
  "Snacks":      ["Extra Sauce","Extra Cheese","No Seasoning","Spicy","Extra Dip"],
  "Others":      ["Extra Sauce","Spicy","No Onions","Extra Serving"],
};

// Categories that show sugar level
const HAS_SUGAR = ["Drinks"];
// Categories that show add-ons
const HAS_ADDONS = ["Drinks","Desserts","Pasta","Main Course","Snacks","Others"];

// â”€â”€â”€ STATE â”€â”€â”€
const S = {
  dark:true, mode:null,
  menu:{}, orders:[], counter:1000,
  cart:[], cTab:"Drinks", aTab:"Drinks",
  cd:0, cdTimer:null,
  pendingDelId:null,
  imgB64:"",
  custItem:null, custSugar:"100%", custSize:"Medium", custAddons:[],
  pay:"cash",
  fbReady:false, fbDB:null, fbListeners:{}, pollTimer:null
};

// â”€â”€â”€ FIREBASE DYNAMIC IMPORT â”€â”€â”€
const FB_CONFIGURED = !Object.values(FB_CONFIG).some(v => v.startsWith("REPLACE_"));

async function initFirebase() {
  if (!FB_CONFIGURED) { S.fbReady = false; return; }
  try {
    const { initializeApp }   = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js");
    const { getDatabase, ref, set, get, onValue } = await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js");
    const app = initializeApp(FB_CONFIG);
    S.fbDB = getDatabase(app);
    S._ref = (p) => ref(S.fbDB, p);
    S._set = (p, v) => set(ref(S.fbDB, p), v);
    S._get = (p) => get(ref(S.fbDB, p));
    S._on  = (p, cb) => { const unsub = onValue(ref(S.fbDB, p), snap => cb(snap.exists() ? snap.val() : null)); return unsub; };
    S.fbReady = true;
    console.log("âœ… Firebase connected â€” multi-device sync active");
  } catch(e) {
    console.warn("Firebase init failed:", e.message);
    S.fbReady = false;
  }
}

// â”€â”€â”€ STORAGE HELPERS â”€â”€â”€
const LS = {
  get:(k) => { try { const v=localStorage.getItem(k); return v?JSON.parse(v):null; } catch{return null;} },
  set:(k,v) => { try { localStorage.setItem(k,JSON.stringify(v)); } catch{} }
};

async function dbGet(path) {
  if (S.fbReady) {
    try { const s = await S._get(path); return s.exists() ? s.val() : null; } catch{}
  }
  return LS.get(path.replace(/\//g,":"));
}
async function dbSet(path, val) {
  LS.set(path.replace(/\//g,":"), val); // always write locally too
  if (S.fbReady) { try { await S._set(path, val); } catch(e){ console.warn(e); } }
}
function dbListen(path, cb) {
  if (!S.fbReady) return;
  const unsub = S._on(path, cb);
  S.fbListeners[path] = unsub;
}
function dbUnlisten(path) {
  if (S.fbListeners[path]) { S.fbListeners[path](); delete S.fbListeners[path]; }
}

async function loadAll() {
  const [m,o,c] = await Promise.all([dbGet("test/menu"),dbGet("test/orders"),dbGet("test/counter")]);
  applyMenuData(m);
  applyOrdersData(o);
  if (c != null) S.counter = c;
}
function applyMenuData(m) {
  if (m) { S.menu = m; CATS.forEach(c=>{if(!S.menu[c])S.menu[c]=[];}); }
  else { S.menu={}; CATS.forEach(c=>S.menu[c]=[]); }
}
function applyOrdersData(o) {
  if (!o) { S.orders=[]; return; }
  S.orders = Array.isArray(o) ? o : Object.values(o).filter(Boolean);
}

async function saveMenu()    { setSyncing(true); await dbSet("test/menu", S.menu);    setTimeout(()=>setSyncing(false),600); }
async function saveOrders()  { await dbSet("test/orders",  S.orders);  }
async function saveCounter() { await dbSet("test/counter", S.counter); }

function startSync() {
  if (S.fbReady) {
    // Firebase real-time listeners
    dbListen("test/menu", d => { applyMenuData(d); if(S.mode==='c'){renderMenuGrid();}if(S.mode==='a'){renderAdminGrid();} });
    dbListen("test/orders", d => { applyOrdersData(d); if(S.mode==='a'){renderOrders();renderStats();} });
    dbListen("test/counter", d => { if(d!=null) S.counter=d; });
    setDot(true, "Live ğŸ”¥");
  } else {
    // Fallback: poll localStorage every 3s for same-device cross-tab sync
    S.pollTimer = setInterval(() => {
      const m=LS.get("test:menu"), o=LS.get("test:orders");
      applyMenuData(m); applyOrdersData(o);
      if(S.mode==='c') renderMenuGrid();
      if(S.mode==='a'){ renderOrders(); renderAdminGrid(); renderStats(); }
    }, 3000);
    setDot(false, "Local");
  }
}
function stopSync() {
  Object.keys(S.fbListeners).forEach(p => { S.fbListeners[p](); delete S.fbListeners[p]; });
  if (S.pollTimer) { clearInterval(S.pollTimer); S.pollTimer=null; }
}
function setDot(live, label) {
  ["cDot","aDot"].forEach(id=>{ const el=document.getElementById(id); if(el){ el.classList.toggle("offline",!live); el.classList.remove("saving"); }});
  ["cDotLbl","aDotLbl"].forEach(id=>{ const el=document.getElementById(id); if(el) el.textContent=label; });
}
function setSyncing(on) {
  ["cDot","aDot"].forEach(id=>{ const el=document.getElementById(id); if(el) el.classList.toggle("saving",on); });
}

// â”€â”€â”€ UTILS â”€â”€â”€
const fmt  = n => `â‚±${parseFloat(n||0).toFixed(2)}`;
const uid  = () => `i_${Date.now()}_${Math.random().toString(36).slice(2,6)}`;
const esc  = s => String(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const f2b64 = f => new Promise((res,rej)=>{ const r=new FileReader(); r.onload=e=>res(e.target.result); r.onerror=rej; r.readAsDataURL(f); });

// â”€â”€â”€ THEME â”€â”€â”€
function applyTheme() {
  document.body.classList.toggle("dark", S.dark);
  document.body.classList.toggle("light",!S.dark);
  const [e,t] = S.dark ? ["â˜€ï¸","Light"] : ["ğŸŒ™","Dark"];
  ["landThemeBtn","cThemeBtn","aThemeBtn"].forEach(id=>{ const b=document.getElementById(id); if(b) b.innerHTML=`${e} <span>${t}</span>`; });
}
function toggleTheme(){ S.dark=!S.dark; LS.set("test:dark",S.dark?1:0); applyTheme(); }

// â”€â”€â”€ TOAST â”€â”€â”€
function toast(msg, type="info") {
  const el=document.createElement("div"); el.className=`toast ${type}`; el.textContent=msg;
  document.getElementById("toasts").appendChild(el);
  setTimeout(()=>el.remove(),3200);
}

// â”€â”€â”€ MODALS â”€â”€â”€
function openModal(id)  { document.getElementById(id).classList.add("open"); }
function closeModal(id) { document.getElementById(id).classList.remove("open"); }

// â”€â”€â”€ SCREENS â”€â”€â”€
function showScreen(id){ document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active")); document.getElementById(id).classList.add("active"); }

function exitToLanding(){
  stopSync(); S.mode=null; S.cart=[];
  if(S.cdTimer){ clearInterval(S.cdTimer); S.cdTimer=null; S.cd=0; }
  showScreen("landing");
}

// â”€â”€â”€ CONSUMER ENTRY â”€â”€â”€
async function enterConsumer(){
  S.mode="c"; S.cart=[]; S.cTab="Drinks";
  showScreen("consumerScreen");
  await loadAll();
  buildCTabs(); renderMenuGrid(); renderCart();
  startSync();
}

// â”€â”€â”€ ADMIN ENTRY â”€â”€â”€
function openAdminLogin(){ document.getElementById("pinInput").value=""; document.getElementById("pinErr").textContent=""; openModal("loginModal"); setTimeout(()=>document.getElementById("pinInput").focus(),100); }
function checkPin(){
  if(document.getElementById("pinInput").value===PIN){ closeModal("loginModal"); enterAdmin(); }
  else{ document.getElementById("pinErr").textContent="Incorrect PIN. Try again."; document.getElementById("pinInput").value=""; }
}
async function enterAdmin(){
  S.mode="a"; S.aTab="Drinks";
  showScreen("adminScreen");
  await loadAll();
  if(!S.fbReady) document.getElementById("fbNote").style.display="";
  buildATabs(); renderStats(); renderOrders(); renderAdminGrid();
  startSync();
}

// â”€â”€â”€ CONSUMER TABS â”€â”€â”€
function buildCTabs(){
  document.getElementById("cTabs").innerHTML = CATS.map(c=>
    `<button class="tab-btn${c===S.cTab?" active":""}" onclick="switchCTab('${esc(c)}')">${CAT_ICO[c]} ${esc(c)}</button>`
  ).join("");
}
function switchCTab(c){ S.cTab=c; buildCTabs(); renderMenuGrid(); }

// â”€â”€â”€ MENU GRID â”€â”€â”€
function renderMenuGrid(){
  document.getElementById("menuTitle").textContent=`${CAT_ICO[S.cTab]} ${S.cTab}`;
  const items=(S.menu[S.cTab]||[]);
  const g=document.getElementById("menuGrid");
  if(!items.length){ g.innerHTML=`<div class="empty-state"><div class="empty-ico">ğŸ½ï¸</div>No items in this category yet.</div>`; return; }
  g.innerHTML=items.map(item=>`
    <div class="menu-card${item.unavailable?" unavail":""}" onclick="${item.unavailable?"":"openCust('"+esc(item.id)+"')"}">
      ${item.unavailable?'<div class="unavail-ribbon">Not Available</div>':""}
      ${item.image?`<img class="card-img" src="${esc(item.image)}" alt="${esc(item.name)}">`:`<div class="card-ph">${CAT_ICO[item.category]||"ğŸ½ï¸"}</div>`}
      <div class="card-body">
        <div class="card-name">${esc(item.name)}</div>
        <div class="card-desc">${esc(item.desc||"")}</div>
        <div class="card-footer">
          <div class="card-price">${fmt(item.price)}</div>
          ${!item.unavailable?`<button class="add-btn" onclick="event.stopPropagation();openCust('${esc(item.id)}')">+</button>`:""}
        </div>
      </div>
    </div>`).join("");
}

// â”€â”€â”€ ITEM CUSTOMISATION â”€â”€â”€
function openCust(id){
  const item=findById(id); if(!item||item.unavailable) return;
  const cat    = item.category;
  const sizes  = CAT_SIZES[cat]  || ["Regular","Large"];
  const addons = CAT_ADDONS[cat] || [];
  const showSugar  = HAS_SUGAR.includes(cat);
  const showAddons = addons.length > 0;

  S.custItem=item; S.custSugar="100%"; S.custSize=sizes[0]; S.custAddons=[];
  document.getElementById("custName").textContent=item.name;
  document.getElementById("custPrice").textContent=fmt(item.price);
  document.getElementById("custNotes").value="";

  // Image
  const iw=document.getElementById("custImgWrap");
  iw.innerHTML=item.image?`<img class="cust-img" src="${esc(item.image)}" alt="${esc(item.name)}">`:`<div class="cust-ph">${CAT_ICO[cat]||"ğŸ½ï¸"}</div>`;

  // Sugar section (drinks only)
  document.getElementById("sugarSec").style.display=showSugar?"":"none";
  document.getElementById("sugarChips").innerHTML=SUGARS.map(s=>`<button class="chip${s===S.custSugar?" sel":""}" onclick="pickSugar('${s}')">${s}</button>`).join("");

  // Size section â€” options vary per category
  document.getElementById("sizeChips").innerHTML=sizes.map(s=>`<button class="chip${s===S.custSize?" sel":""}" onclick="pickSize('${s}')">${s}</button>`).join("");

  // Add-ons section â€” options vary per category
  document.getElementById("addonSec").style.display=showAddons?"":"none";
  document.getElementById("addonChips").innerHTML=addons.map(a=>`<button class="chip multi" id="ao_${esc(a.replace(/\s/g,'_'))}" onclick="togAddon('${esc(a)}')">${esc(a)}</button>`).join("");

  openModal("custModal");
}
function pickSugar(v){ S.custSugar=v; document.querySelectorAll("#sugarChips .chip").forEach(c=>c.classList.toggle("sel",c.textContent.trim()===v)); }
function pickSize(v) { S.custSize=v;  document.querySelectorAll("#sizeChips .chip").forEach(c=>c.classList.toggle("sel",c.textContent.trim()===v)); }
function togAddon(v){
  const i=S.custAddons.indexOf(v); i>-1?S.custAddons.splice(i,1):S.custAddons.push(v);
  const el=document.getElementById("ao_"+v.replace(/\s/g,"_")); if(el) el.classList.toggle("sel",S.custAddons.includes(v));
}
function addToCart(){
  const item=S.custItem; if(!item) return;
  const cat     = item.category;
  const addons  = CAT_ADDONS[cat] || [];
  const showSugar  = HAS_SUGAR.includes(cat);
  const showAddons = addons.length > 0;
  const notes=document.getElementById("custNotes").value.trim();
  const mods=[];
  if(showSugar) mods.push(`Sugar: ${S.custSugar}`);
  mods.push(`Size: ${S.custSize}`);
  if(showAddons&&S.custAddons.length) mods.push(`Add-ons: ${S.custAddons.join(", ")}`);
  if(notes) mods.push(`Note: ${notes}`);
  S.cart.push({cartId:uid(), id:item.id, name:item.name, price:item.price, qty:1, mods});
  renderCart(); closeModal("custModal"); toast(`${item.name} added`,"success");
}

// â”€â”€â”€ CART â”€â”€â”€
function findById(id){ for(const c of CATS){ const f=(S.menu[c]||[]).find(i=>i.id===id); if(f) return f; } return null; }
function chgQty(cid,d){ const i=S.cart.findIndex(c=>c.cartId===cid); if(i<0) return; S.cart[i].qty+=d; if(S.cart[i].qty<=0) S.cart.splice(i,1); renderCart(); }
function renderCart(){
  const total=S.cart.reduce((s,c)=>s+c.price*c.qty,0);
  const wrap=document.getElementById("cartItems");
  wrap.innerHTML=!S.cart.length?'<div class="cart-empty">Your cart is empty</div>':
    S.cart.map(c=>`
      <div class="cart-item">
        <div class="ci-info">
          <div class="ci-name">${esc(c.name)}</div>
          ${c.mods&&c.mods.length?`<div class="ci-mods">${c.mods.map(m=>esc(m)).join(" Â· ")}</div>`:""}
          <div class="ci-qty">
            <button class="qty-btn" onclick="chgQty('${esc(c.cartId)}',-1)">âˆ’</button>
            <span class="qty-num">${c.qty}</span>
            <button class="qty-btn" onclick="chgQty('${esc(c.cartId)}',1)">+</button>
          </div>
        </div>
        <div class="ci-price">${fmt(c.price*c.qty)}</div>
      </div>`).join("");
  document.getElementById("cartTotal").textContent=fmt(total);
  updPlaceBtn();
}

// â”€â”€â”€ PLACE ORDER BUTTON (fixed CSS) â”€â”€â”€
function updPlaceBtn(){
  const btn=document.getElementById("placeBtn"); if(!btn) return;
  // Always reset first
  btn.classList.remove("cd");
  btn.removeAttribute("disabled");
  if(S.cd>0){
    btn.classList.add("cd");
    btn.setAttribute("disabled","");
    btn.textContent=`Please waitâ€¦ ${S.cd}s`;
  } else if(!S.cart.length){
    btn.setAttribute("disabled","");
    btn.textContent="Place Order";
  } else {
    btn.textContent="Place Order";
  }
}

// â”€â”€â”€ ORDER REVIEW â”€â”€â”€
function openOrderReview(){
  if(!S.cart.length||S.cd>0) return;
  const total=S.cart.reduce((s,c)=>s+c.price*c.qty,0);
  document.getElementById("reviewList").innerHTML=S.cart.map(c=>`
    <div class="rev-row">
      <div>
        <div>${c.qty}Ã— ${esc(c.name)}</div>
        ${c.mods&&c.mods.length?`<div class="rev-mods">${c.mods.map(m=>esc(m)).join(" Â· ")}</div>`:""}
      </div>
      <div class="rev-price">${fmt(c.price*c.qty)}</div>
    </div>`).join("");
  document.getElementById("reviewTotal").textContent=fmt(total);
  openModal("reviewModal");
}

// â”€â”€â”€ PAYMENT â”€â”€â”€
function openPayment(){ closeModal("reviewModal"); S.pay="cash"; selPay("cash"); openModal("payModal"); }
function selPay(m){
  S.pay=m;
  document.getElementById("payCash").classList.toggle("sel",m==="cash");
  document.getElementById("payOnline").classList.toggle("sel",m==="online");
  document.getElementById("cashInfo").style.display=m==="cash"?"":"none";
  document.getElementById("onlineInfo").style.display=m==="online"?"":"none";
}
async function finalizeOrder(){
  closeModal("payModal");
  const total=S.cart.reduce((s,c)=>s+c.price*c.qty,0);
  S.counter++;
  const num=S.counter;
  const isOnline=S.pay==="online";
  const order={
    num, items:S.cart.map(c=>({name:c.name,qty:c.qty,price:c.price,mods:c.mods||[]})),
    total, status:isOnline?"accepted":"pending",
    payment:S.pay, ts:new Date().toLocaleTimeString()
  };
  S.orders.unshift(order);
  await saveOrders(); await saveCounter();
  S.cart=[]; renderCart();
  // Confirm modal
  document.getElementById("confNum").textContent=`#${num}`;
  document.getElementById("confMsg").textContent=isOnline
    ?"Show your online receipt to the cashier for confirmation!"
    :"Remember your number and please go toward to the cashier to proceed with your order.";
  document.getElementById("confBadge").innerHTML=isOnline
    ?`<div class="conf-badge online">âœ… Online â€” Auto Confirmed</div>`
    :`<div class="conf-badge cash">ğŸ’µ Cash â€” Awaiting Cashier</div>`;
  openModal("confirmModal");
  // Cooldown
  S.cd=CD_SECS; updPlaceBtn();
  S.cdTimer=setInterval(()=>{ S.cd--; updPlaceBtn(); if(S.cd<=0){clearInterval(S.cdTimer);S.cdTimer=null;} },1000);
}
function closeDone(){ closeModal("confirmModal"); }

// â”€â”€â”€ ADMIN STATS â”€â”€â”€
function renderStats(){
  const rev =S.orders.filter(o=>o.status==="accepted").reduce((s,o)=>s+o.total,0);
  const acc =S.orders.filter(o=>o.status==="accepted").length;
  const pen =S.orders.filter(o=>o.status==="pending").length;
  const dec =S.orders.filter(o=>o.status==="declined").length;
  const stats=[
    {lbl:"Total Revenue",val:fmt(rev),col:"var(--success)"},
    {lbl:"Total Orders", val:S.orders.length,col:"var(--accent)"},
    {lbl:"Accepted",val:acc,col:"var(--success)"},
    {lbl:"Pending",val:pen,col:"var(--orange)"},
    {lbl:"Declined",val:dec,col:"var(--danger)"},
  ];
  document.getElementById("statsRow").innerHTML=stats.map(s=>`<div class="stat-card"><div class="stat-lbl">${s.lbl}</div><div class="stat-val" style="color:${s.col}">${s.val}</div></div>`).join("");
}

// â”€â”€â”€ ADMIN ORDERS â”€â”€â”€
function renderOrders(){
  const w=document.getElementById("ordersWrap");
  if(!S.orders.length){ w.innerHTML='<div class="no-data">No orders yet.</div>'; return; }
  w.innerHTML=`<div class="orders-wrap"><table class="orders-tbl">
    <thead><tr><th>Order #</th><th>Time</th><th>Payment</th><th>Items</th><th>Total</th><th>Status</th><th>Action</th></tr></thead>
    <tbody>${S.orders.map(o=>`
      <tr>
        <td><strong style="font-family:monospace;color:var(--accent)">#${o.num}</strong></td>
        <td style="color:var(--muted);font-size:.75rem;white-space:nowrap">${esc(o.ts)}</td>
        <td style="font-size:.8rem">${o.payment==="online"?"ğŸ“± Online":"ğŸ’µ Cash"}</td>
        <td class="oi-list">${(o.items||[]).map(i=>`${i.qty}Ã— ${esc(i.name)}${i.mods&&i.mods.length?`<br><span style="font-size:.68rem;color:var(--muted)">${i.mods.map(m=>esc(m)).join(" Â· ")}</span>`:""}`).join("<br>")}</td>
        <td><span style="font-family:monospace;color:var(--accent)">${fmt(o.total)}</span></td>
        <td><span class="badge b-${o.status}">${o.status}${o.payment==="online"?" âš¡":""}</span></td>
        <td>${o.status==="pending"?`<div class="act-wrap"><button class="btn-accept" onclick="setStatus(${o.num},'accepted')">âœ“ Accept</button><button class="btn-decline" onclick="setStatus(${o.num},'declined')">âœ— Decline</button></div>`:`<span style="color:var(--muted);font-size:.78rem">â€”</span>`}</td>
      </tr>`).join("")}
    </tbody></table></div>`;
}
async function setStatus(num,status){
  const o=S.orders.find(o=>o.num===num); if(!o) return;
  o.status=status; await saveOrders(); renderOrders(); renderStats();
  toast(`Order #${num} â†’ ${status}`,status==="declined"?"error":"success");
}

// â”€â”€â”€ ADMIN MENU TABS â”€â”€â”€
function buildATabs(){
  document.getElementById("adminTabs").innerHTML=CATS.map(c=>`<button class="atab-btn${c===S.aTab?" active":""}" onclick="switchATab('${esc(c)}')">${CAT_ICO[c]} ${esc(c)}</button>`).join("");
  const sel=document.getElementById("iCat"); if(sel) sel.innerHTML=CATS.map(c=>`<option value="${esc(c)}">${esc(c)}</option>`).join("");
}
function switchATab(c){ S.aTab=c; buildATabs(); renderAdminGrid(); }

// â”€â”€â”€ ADMIN MENU GRID â”€â”€â”€
function renderAdminGrid(){
  const items=S.menu[S.aTab]||[];
  const g=document.getElementById("adminGrid");
  if(!items.length){ g.innerHTML='<div class="no-data" style="grid-column:1/-1">No items yet. Add one above.</div>'; return; }
  g.innerHTML=items.map(item=>`
    <div class="ai-card${item.unavailable?" unavail":""}">
      ${item.image?`<img class="ai-img" src="${esc(item.image)}" alt="${esc(item.name)}">`:`<div class="ai-ph">${CAT_ICO[item.category]||"ğŸ½ï¸"}</div>`}
      <div class="ai-body">
        <div class="ai-name">${esc(item.name)}</div>
        <div class="ai-price">${fmt(item.price)}</div>
        <div class="ai-desc">${esc(item.desc||"â€”")}</div>
        ${item.unavailable?'<div class="ai-unavail-tag">Not Available</div>':""}
        <div class="ai-actions">
          <button class="btn-ai btn-edit" onclick="openEditItem('${esc(item.id)}')">âœ Edit</button>
          <button class="btn-ai ${item.unavailable?"btn-avail":"btn-navail"}" onclick="togAvail('${esc(item.id)}')">${item.unavailable?"âœ“ Available":"âœ• Unavail"}</button>
          <button class="btn-ai btn-del" onclick="openDelConfirm('${esc(item.id)}','${esc(item.name)}')">ğŸ—‘ Del</button>
        </div>
      </div>
    </div>`).join("");
}

// â”€â”€â”€ AVAILABILITY TOGGLE â”€â”€â”€
async function togAvail(id){
  CATS.forEach(c=>{ const item=(S.menu[c]||[]).find(i=>i.id===id); if(item) item.unavailable=!item.unavailable; });
  await saveMenu(); renderAdminGrid();
  toast("Availability updated","info");
}

// â”€â”€â”€ DELETE CONFIRM â”€â”€â”€
function openDelConfirm(id,name){ S.pendingDelId=id; document.getElementById("delName").textContent=`"${name}"`; openModal("delModal"); }
async function confirmDelete(){
  const id=S.pendingDelId; if(!id) return;
  CATS.forEach(c=>{ S.menu[c]=(S.menu[c]||[]).filter(i=>i.id!==id); });
  await saveMenu(); closeModal("delModal"); renderAdminGrid(); S.pendingDelId=null;
  toast("Item deleted","info");
}

// â”€â”€â”€ ADD / EDIT ITEM â”€â”€â”€
function openAddItem(){
  document.getElementById("itemModalTitle").textContent="Add Item";
  document.getElementById("itemModalSub").textContent="Fill in the details below";
  document.getElementById("editId").value="";
  document.getElementById("iCat").value=S.aTab;
  document.getElementById("iName").value="";
  document.getElementById("iPrice").value="";
  document.getElementById("iDesc").value="";
  document.getElementById("iUnavail").checked=false;
  clearImg(); openModal("itemModal");
}
function openEditItem(id){
  const item=findById(id); if(!item) return;
  document.getElementById("itemModalTitle").textContent="Edit Item";
  document.getElementById("itemModalSub").textContent="Modify the details below";
  document.getElementById("editId").value=id;
  document.getElementById("iCat").value=item.category;
  document.getElementById("iName").value=item.name;
  document.getElementById("iPrice").value=item.price;
  document.getElementById("iDesc").value=item.desc||"";
  document.getElementById("iUnavail").checked=!!item.unavailable;
  item.image?setImg(item.image):clearImg();
  openModal("itemModal");
}
async function saveItem(){
  const name =document.getElementById("iName").value.trim();
  const price=parseFloat(document.getElementById("iPrice").value);
  const desc =document.getElementById("iDesc").value.trim();
  const cat  =document.getElementById("iCat").value;
  const editId=document.getElementById("editId").value;
  const unavailable=document.getElementById("iUnavail").checked;
  if(!name)             { toast("Item name required","error"); return; }
  if(isNaN(price)||price<0){ toast("Enter a valid price","error"); return; }
  CATS.forEach(c=>{ if(!S.menu[c]) S.menu[c]=[]; });
  if(editId){
    for(const c of CATS) S.menu[c]=S.menu[c].filter(i=>i.id!==editId);
    S.menu[cat].push({id:editId,name,price,desc,image:S.imgB64,category:cat,unavailable});
    toast("Item updated!","success");
  } else {
    S.menu[cat].push({id:uid(),name,price,desc,image:S.imgB64,category:cat,unavailable});
    toast("Item added!","success");
  }
  await saveMenu(); closeModal("itemModal"); renderAdminGrid();
}

// â”€â”€â”€ IMAGE â”€â”€â”€
async function handleImg(e){ const f=e.target.files?.[0]; if(!f) return; if(f.size>2*1024*1024){alert("Image must be under 2MB");return;} setImg(await f2b64(f)); }
function setImg(src){ S.imgB64=src; document.getElementById("imgPh").style.display="none"; document.getElementById("imgPrev").src=src; document.getElementById("imgPrev").style.display="block"; document.getElementById("imgRm").style.display="flex"; document.getElementById("imgZone").classList.add("has-img"); }
function clearImg(){ S.imgB64=""; document.getElementById("imgPh").style.display="flex"; document.getElementById("imgPrev").style.display="none"; document.getElementById("imgPrev").src=""; document.getElementById("imgRm").style.display="none"; document.getElementById("imgZone").classList.remove("has-img"); document.getElementById("imgFile").value=""; }

// â”€â”€â”€ INIT â”€â”€â”€
(async function init(){
  const saved=LS.get("test:dark"); if(saved!==null) S.dark=saved===1||saved==="1"||saved===true;
  applyTheme();
  await initFirebase();
  await loadAll();
  showScreen("landing");
})();
</script>
</body>
</html>
